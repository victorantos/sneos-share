import fs from 'fs';
import path from 'path';
import matter from 'gray-matter';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

const AUTOGENERATED_DIR = path.join(__dirname, '../docs/autogenerated');

// Category folder mapping
const categoryFolders = {
  'AI Comparison': 'ai-comparison',
  'Education': 'education',
  'Finance': 'finance',
  'Lawyers': 'lawyers',
  'Legal': 'legal',
  'Research': 'research',
  'Universities': 'universities',
  'VIRAL CONTENT': 'viral-content'
};

function categorizeFile(description) {
  const desc = description.toLowerCase();

  if (desc.includes('career advice') || desc.includes('skills development') ||
      desc.includes('learning') || desc.includes('study') || desc.includes('education') ||
      desc.includes('homeschool') || desc.includes('test preparation')) {
    return 'Education';
  } else if (desc.includes('investment') || desc.includes('crypto') ||
             desc.includes('debt') || desc.includes('money') || desc.includes('finance') ||
             desc.includes('retirement') || desc.includes('tax')) {
    return 'Finance';
  } else if (desc.includes('lawyer') || desc.includes('law firm') || desc.includes('legal practice')) {
    return 'Lawyers';
  } else if (desc.includes('employment law') || desc.includes('constitutional') ||
             desc.includes('immigration law') || desc.includes('legal') || desc.includes('court')) {
    return 'Legal';
  } else if (desc.includes('research') || desc.includes('science') || desc.includes('technology breakthrough')) {
    return 'Research';
  } else if (desc.includes('university') || desc.includes('college') || desc.includes('admissions') ||
             desc.includes('scholarship') || desc.includes('student debt')) {
    return 'Universities';
  } else if (desc.includes('millionaire') || desc.includes('secrets') || desc.includes('viral') ||
             desc.includes('celebrity') || desc.includes('conspiracy')) {
    return 'VIRAL CONTENT';
  }

  return 'AI Comparison';
}

// Read all markdown files
const files = fs.readdirSync(AUTOGENERATED_DIR)
  .filter(f => f.endsWith('.md') && f !== 'index.md');

let moveCount = 0;
const categoryCounts = {};

files.forEach(filename => {
  const filePath = path.join(AUTOGENERATED_DIR, filename);
  const content = fs.readFileSync(filePath, 'utf-8');
  const { data } = matter(content);

  const description = data.description || '';
  const category = categorizeFile(description);
  const categoryFolder = categoryFolders[category];

  if (!categoryCounts[category]) {
    categoryCounts[category] = 0;
  }
  categoryCounts[category]++;

  const newPath = path.join(AUTOGENERATED_DIR, categoryFolder, filename);

  // Move the file
  fs.renameSync(filePath, newPath);
  moveCount++;
});

console.log(`âœ… Moved ${moveCount} files into category folders:`);
Object.keys(categoryCounts).forEach(cat => {
  console.log(`   - ${cat}: ${categoryCounts[cat]} files`);
});